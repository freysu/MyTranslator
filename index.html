<!doctype html>
<html lang="en"> 
    <head> 
        <meta charset="utf-8"> 
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> 
        <meta name="description" content=""> 
        <meta name="author" content=""> 
        <title>论文翻译降重助手</title> <!-- Favicon--> 
        <link rel="icon" type="image/x-icon" href="assets/favicon.ico"> <!-- Bootstrap icons --> 
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" type="text/css"> <!-- Core theme CSS (includes Bootstrap)--> 
        <link href="css/styles.css" rel="stylesheet"> 
        <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
		</script> 
        <script>
			var _hmt = _hmt || [];
			(function() {
				var hm = document.createElement("script");
				hm.src = "https://hm.baidu.com/hm.js?969726398af7e833bb6e27106709692b";
				var s = document.getElementsByTagName("script")[0];
				s.parentNode.insertBefore(hm, s);
			})();
		</script> 
    </head> 
    <body> 
        <nav class="navbar navbar-light bg-light static-top"> 
            <div class="container"> <a class="navbar-brand" href="#signup">论文翻译降重助手</a> <a class="btn btn-primary" href="#signup" id="firstUse">开始使用</a> 
            </div> 
        </nav> 
        <header class="masthead"> 
            <div class="container position-relative"> 
                <div class="row justify-content-center"> 
                    <div class="col-xl-6"> 
                        <div class="text-center text-white"> 
                            <h1 class="mb-5" id="start">论文翻译降重助手</h1> 
                            <div class="row"> 
                                <div class="col "> 
                                    <input class="input-lg form-control	 form-control-lg originData" type="text" placeholder="请在这里输入要翻译的文本" value=""> 
                                </div> 
                            </div> 
                            <div class="col-auto"> <button style="margin: 15px;" class="btn btn-dark btn-md translateAndCompareBtn" type="button">翻译并对比</button> <button style="margin: 15px;" class="btn btn-danger btn-md clear" type="button">清空</button> <button style="margin: 15px;" class="btn btn-primary btn-md translateBtn" type="button">翻译</button> <button style="margin: 15px;" class="btn btn-primary btn-md compare" type="button">对比</button> 
                            </div> 
                        </div> 
                    </div> 
                </div> 
            </div> 
        </header> 
        <section class="showcase"> 
            <div class="container-fluid p-0 "> 
                <div class="row g-0 "> 
                    <div class="col-lg-6 order-lg-1 my-auto showcase-text" id="res1"> 
                        <h2>翻译结果1<a class="btn btn-default btn-sm clipboard clipboard" href="javascript:" data-clipboard-target="#newData">复制</a></h2> 
                        <p class="lead mb-0 form-control newData " id="newData"></p> 
                        <h4 style="margin-top: 9px;"> 对比结果1 <a class="btn btn-default btn-sm clipboard clipboard" href="javascript:" data-clipboard-target="#compareData">复制</a> </h4> 
                        <p class="compareRes mb-0 form-control compareData " id="compareData"></p> 
                    </div> 
                </div> 
                <div class="row g-0"> 
                    <div class="col-lg-6 my-auto showcase-text"> 
                        <h2>翻译结果2<a class="btn btn-default btn-sm clipboard clipboard" href="javascript:" data-clipboard-target="#newData1">复制</a></h2> 
                        <p class="lead mb-0 form-control newData1" id="newData1"></p> 
                        <h4 style="margin-top: 9px;"> 对比结果2 <a class="btn btn-default btn-sm clipboard clipboard" href="javascript:" data-clipboard-target="#compareData1">复制</a> </h4> 
                        <p class="compareRes mb-0 form-control compareData1 " id="compareData1"></p> 
                    </div> 
                </div> 
                <div class="row g-0"> 
                    <div class="col-lg-6 order-lg-1 my-auto showcase-text"> 
                        <h2>翻译结果3<a class="btn btn-default btn-sm clipboard clipboard" href="javascript:" data-clipboard-target="#newData2">复制</a></h2> 
                        <p class="lead mb-0 form-control newData2" id="newData2"></p> 
                        <h4 style="margin-top: 9px;"> 对比结果3 <a class="btn btn-default btn-sm clipboard clipboard" href="javascript:" data-clipboard-target="#compareData2">复制</a> </h4> 
                        <p class="compareRes mb-0 form-control compareData2 " id="compareData2"></p> 
                    </div> 
                </div> 
                <div class="row g-0"> 
                    <div class="col-lg-6 order-lg-1 my-auto showcase-text"> 
                        <h2>翻译结果4<a class="btn btn-default btn-sm clipboard clipboard" href="javascript:" data-clipboard-target="#newData3">复制</a></h2> 
                        <p class="lead mb-0 form-control newData3" id="newData3"></p> 
                        <h4 style="margin-top: 9px;"> 对比结果4 <a class="btn btn-default btn-sm clipboard clipboard" href="javascript:" data-clipboard-target="#compareData3">复制</a> </h4> 
                        <p class="compareRes mb-0 form-control compareData3 " id="compareData3"></p> 
                    </div> 
                </div> 
                <div class="row g-0"> 
                    <div class="col-lg-6 order-lg-1 my-auto showcase-text"> 
                        <h2>翻译结果5<a class="btn btn-default btn-sm clipboard clipboard" href="javascript:" data-clipboard-target="#newData4">复制</a></h2> 
                        <p class="lead mb-0 form-control newData4" id="newData4"></p> 
                        <h4 style="margin-top: 9px;"> 对比结果5 <a class="btn btn-default btn-sm clipboard clipboard" href="javascript:" data-clipboard-target="#compareData4">复制</a> </h4> 
                        <p class="compareRes mb-0 form-control compareData4 " id="compareData4"></p> 
                    </div> 
                </div> 
                <div class="row g-0"> 
                    <div class="col-lg-6 order-lg-1 my-auto showcase-text"> 
                        <h2>翻译结果6<a class="btn btn-default btn-sm clipboard clipboard" href="javascript:" data-clipboard-target="#newData5">复制</a></h2> 
                        <p class="lead mb-0 form-control newData5" id="newData5"></p> 
                        <h4 style="margin-top: 9px;"> 对比结果6 <a class="btn btn-default btn-sm clipboard clipboard" href="javascript:" data-clipboard-target="#compareData5">复制</a> </h4> 
                        <p class="compareRes mb-0 form-control compareData5 " id="compareData5"></p> 
                    </div> 
                </div> 
            </div> 
        </section> <!-- Call to Action--> 
        <section class="call-to-action text-white text-center" id="signup"> 
            <div class="container position-relative"> 
                <div class="row justify-content-center"> 
                    <div class="col-xl-6"> 
                        <h2 class="mb-4" id="account">请在这配置账号</h2> 
                        <form class="form-subscribe" id="contactFormFooter"> 
                            <div class="row"> 
                                <div class="col"> 
                                    <input class="form-control form-control-lg" id="yourAppid" type="text" placeholder="appid" title="在这输入你的百度翻译API的appid"> 
                                </div> 
                                <div class="col"> 
                                    <input class="form-control form-control-lg" id="yourKey" type="text" placeholder="key" title="在这输入你的百度翻译API的key"> 
                                </div> 
                            </div> 
                            <div class="col-auto"> <button style="margin:27px" class="btn btn-primary btn-md " id="saveBtn" type="button">保存</button> <button style="margin:27px" class="btn btn-danger btn-md " id="deleteBtn" type="button">删除</button> <a style="margin:27px" class="btn btn-warning btn-md helpTip" id="helpTip" title="如果遇到不懂可以查阅使用说明" href="https://freysu.github.io/2022/02/28/%E8%AE%BA%E6%96%87%E7%BF%BB%E8%AF%91%E9%99%8D%E9%87%8D%E5%8A%A9%E6%89%8B%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E%E6%96%87%E6%A1%A3/">帮助</a> 
                            </div> 
                        </form> 
                    </div> 
                </div> 
            </div>
        </section> <!-- Footer--> 
        <footer class="footer bg-light"> 
            <div class="container"> 
                <div class="row"> 
                    <div class="col-lg-6 h-100 text-center text-lg-start my-auto"> 
                        <ul class="list-inline mb-2"> 
                            <li class="list-inline-item"><a href="#!">About</a></li> 
                            <li class="list-inline-item">⋅</li> 
                        </ul> 
                        <p class="text-muted small mb-4 mb-lg-0">© Frey 2021. All Rights Reserved.</p> 
                    </div> 
                    <div class="col-lg-6 h-100 text-center text-lg-end my-auto"> <span id="busuanzi_container_page_pv"> 本文总阅读量<span id="busuanzi_value_page_pv"></span>次 </span> 
                        <ul class="list-inline mb-0"> 
                            <li class="list-inline-item me-4"> <a href="https://freysu.github.io/"><i class="bi-github fs-3"></i></a> </li> 
                            <li class="list-inline-item me-4"> <a href="https://github.com/freysu"><i class="bi-github fs-3"></i></a> </li> 
                        </ul> 
                    </div> 
                </div> 
            </div> 
        </footer> 
        <script src="https://cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script> 
        <script src="https://cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script> <!-- Bootstrap core JS--> 
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script> <!-- Core theme JS--> 
        <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script> 
        <script src="./js/md5.js"></script> <!-- <script src="./js/compare.js"></script> --> 
        <script type="text/javascript">
			var clipboard = new ClipboardJS('.clipboard');
		</script> 
        <script>
			// function appidSet() {
			// 	var appid1 = prompt('请输入你的百度翻译API的appid');
			// 	if (appid1 == null) {
			// 		appidSet();
			// 	} else if (!appid1) {
			// 		console.log("我知道你没输入appid1哦。。。")
			// 	}
			// 	return appid1;
			// }

			// function keySet() {
			// 	var key1 = prompt('请输入你的百度翻译API的key');
			// 	if (key1 == null) {
			// 		keySet();
			// 	} else if (!key1) {
			// 		console.log("我知道你没输入key1哦。。。")
			// 	}
			// 	return key1;
			// }

			// function accountSet() {
			// 	var choice = prompt("你要登录还是退出吗？登录请输入yes，退出请输入no");
			// 	if (choice === "no") {
			// 		localStorage.removeItem("appid1");
			// 		localStorage.removeItem("key1");
			// 		showToast("已退出...", 2000)
			// 	} else if (choice === "yes") {
			// 		//存储输入框中填入的值
			// 		localStorage.setItem("appid1", appidSet());
			// 		localStorage.setItem("key1", keySet());
			// 		showToast("已保存...", 2000);

			// 	} else {
			// 		showToast("本次操作取消...", 1500)
			// 	}
			// }

			let to = $(".originData");
			let from = $(".newData");
			let from1 = $(".newData1");
			let from2 = $(".newData2");
			let from3 = $(".newData3");
			let from4 = $(".newData4");
			let from5 = $(".newData5");
			let compare = $(".compareData");
			let compare1 = $(".compareData1");
			let compare2 = $(".compareData2");
			let compare3 = $(".compareData3");
			let compare4 = $(".compareData4");
			let compare5 = $(".compareData5");
			let appid = localStorage.getItem("appid1");
			let key = localStorage.getItem("key1");
			const url = 'https://api.fanyi.baidu.com/api/trans/vip/translate';
			let timer = null;

			$("#yourAppid").val(appid);
			$("#yourKey").val(key);

			if (!localStorage.getItem("appid1") || !localStorage.getItem("key1" || localStorage.appid1 == null || localStorage
					.key1 == null)) {
				showToast("请先滚动页面到底来配置账号", 3000)
				// location.href = "#account";
			}

			$("#saveBtn").click(() => {
				const fn = () => {
					let _appid = $("#yourAppid").val();
					let _key = $("#yourKey").val()
					if (!_appid || !_key) {
						showToast("请重新输入！", 1500)
					} else {
						localStorage.setItem("appid1", _appid);
						localStorage.setItem("key1", _key);
						showToast("保存成功！", 2000)
						location.href = "./index.html";
					}
				}
				if (timer !== null) {
					clearTimeout(timer);
				}
				timer = setTimeout(() => {
					fn();
					timer = null;
				}, 500);
			})

			$("#deleteBtn").click(() => {
				const fn = () => {
					localStorage.removeItem("appid1");
					localStorage.removeItem("key1");
					showToast("已删除...下次使用请重新保存！", 2000)
					$("#yourAppid").val("");
					$("#yourKey").val("");
				}
				if (timer !== null) {
					clearTimeout(timer);
				}
				timer = setTimeout(() => {
					fn();
					timer = null;
				}, 500);
			})

			$(".clear").click(() => {
				const fn = () => {
					$(".originData").val("");
					$(".lead").text("此处将会显示翻译结果")
					$(".compareRes").text("此处将会显示对比结果")
				}
				if (timer !== null) {
					clearTimeout(timer);
				}
				timer = setTimeout(() => {
					fn();
					timer = null;
				}, 500);
			})

			$(".translateBtn").click(() => {
				const fn = () => {
					if (!localStorage.getItem("appid1") || !localStorage.getItem("key1")) {
						showToast("您未配置账号，请配置完账号再开始使用...", 3000);
					} else if (to.val() == "") {
						showToast("你未输入要翻译的内容...", 1500);
					} else {
						location.href = "#res1";
						translateMain(0);
					}
				}
				if (timer !== null) {
					clearTimeout(timer);
				}
				timer = setTimeout(() => {
					fn();
					timer = null;
				}, 500);
			})

			$(".translateAndCompareBtn").click(() => {
				const fn = () => {
					if (!localStorage.getItem("appid1") || !localStorage.getItem("key1")) {
						showToast("您未配置账号，请配置完账号再开始使用...", 3000);
					} else if (to.val() == "") {
						showToast("你未输入要翻译的内容所以无法对比...", 1500);
					} else {
						location.href = "#res1";
						showToast("正在翻译中...请耐心等待", 1500);
						translateMain(1);
					}
				}
				if (timer !== null) {
					clearTimeout(timer);
				}
				timer = setTimeout(() => {
					fn();
					timer = null;
				}, 500);
			})

			$(".compare").click(() => {
				const fn = () => {
					if (to.val() == "") {
						showToast("你未输入要翻译的内容所以无法对比...", 1500);
					} else {
						location.href = "#res1";
						showToast("正在对比...", 1500);
						compareMain();
					}
				}
				if (timer !== null) {
					clearTimeout(timer);
				}
				timer = setTimeout(() => {
					fn();
					timer = null;
				}, 500);
			})

			function translateMain(fn = 0) {
				// zh-en-zh
				translateFn(to.val(), 'zh', 'en', (rs) => {
					if (rs == "54003") {
						from.html("修改失败，请稍后重试......");
					} else {
						translateFn(String(rs).replace(/^[“]+/, "").replace(/[”]$/, ""), "en", "zh", (rs) => {
							from.html(rs);
							if (fn) {
								compareMain()
							}
							// console.log("zh-en-zh:", rs);
						})
					}
				});
				// zh-jp-zh
				translateFn(to.val(), "zh", "jp", (rs) => {
					if (rs == "54003") {
						from.html("修改失败，请稍后重试......");
					} else {
						translateFn(String(rs).replace(/^[“]+/, "").replace(/[”]$/, ""), "jp", "zh", (rs) => {
							from1.html(rs);
							if (fn) {
								compareMain()
							}
							// console.log("zh-en-zh:", rs);
						})
					}
				})
				// zh-fra-zh
				translateFn(to.val(), "zh", "fra", (rs) => {
					if (rs == "54003") {
						from.html("修改失败，请稍后重试......");
					} else {
						translateFn(String(rs).replace(/^[“]+/, "").replace(/[”]$/, ""), "fra", "zh", (rs) => {
							from2.html(rs);
							if (fn) {
								compareMain()
							}
							// console.log("zh-fra-zh:", rs);
						})
					}
				});
				// zh-ru-zh
				translateFn(to.val(), "zh", "ru", (rs) => {
					if (rs == "54003") {
						from.html("修改失败，请稍后重试......");
					} else {
						translateFn(String(rs).replace(/^[“]+/, "").replace(/[”]$/, ""), "ru", "zh", (rs) => {
							from3.html(rs);
							if (fn) {
								compareMain()
							}
							// console.log("zh-ru-zh:", rs);
						})
					}
				});
				// zh-spa-zh
				translateFn(to.val(), "zh", "spa", (rs) => {
					if (rs == "54003") {
						from.html("修改失败，请稍后重试......");
					} else {
						translateFn(String(rs).replace(/^[“]+/, "").replace(/[”]$/, ""), "spa", "zh", (rs) => {
							from4.html(rs);
							if (fn) {
								compareMain()
							}
							// console.log("zh-spa-zh:", rs);
						})
					}
				});
				// zh-en-zh-ru-zh
				translateFn(to.val(), "zh", "en", (rs) => {
					if (rs == "54003") {
						from.html("修改失败，请稍后重试......");
					} else {
						translateFn(String(rs).replace(/^[“]+/, "").replace(/[”]$/, ""), "en", "zh", (rs) => {
							if (rs == "54003") {
								from.html("修改失败，请稍后重试......");
							} else {
								translateFn(String(rs).replace(/^[“]+/, "").replace(/[”]$/, ""), "zh", "ru", (
									rs) => {
									if (rs == "54003") {
										from.html("修改失败，请稍后重试......");
									} else {
										translateFn(String(rs).replace(/^[“]+/, "").replace(/[”]$/, ""),
											"ru",
											"zh",
											(rs) => {
												from5.html(rs);
												if (fn) {
													compareMain()
												}
												// console.log("zh-en-zh-ru-zh", rs);
											})
									}
								})
							}
						})
					}
				});
			}


			function translateFn(QUERY, FROM, TO, callback) {
				const salt = (new Date()).getTime();
				const str1 = appid + QUERY + salt + key;
				const sign = MD5.main(str1);
				setTimeout(() => {
					$.ajax({
						url,
						type: 'get',
						// async: true,
						// 跨域
						dataType: 'jsonp',
						contentType: "application/x-www-form-urlencoded; charset=utf-8",
						data: {
							q: QUERY,
							appid: appid,
							salt: salt,
							from: FROM,
							to: TO,
							sign: sign,
						},
						success: (data) => {
							if (data.error_code == "52003") {
								showToast("账号配置出错，请重新配置...", 1500);
								return;
							} else if (data.error_code == "54003") {
								callback(data.error_code)
							} else {
								if (data.trans_result[0].dst) {
									callback(data.trans_result[0].dst)
								}
							}
						},
						error: function(data) {
							alert("error:" + data.status);
						},
					})
				}, 1500);
			}

			function showToast(msg, duration) {
				duration = isNaN(duration) ? 3000 : duration;
				var m = document.createElement('div');
				m.innerHTML = msg;
				m.style.cssText =
					"width:60%; min-width:180px; background:#000; opacity:0.6; height:auto;min-height: 30px; color:#fff; line-height:30px; text-align:center; border-radius:4px; position:fixed; top:60%; left:20%; z-index:999999;";
				document.body.appendChild(m);
				setTimeout(function() {
					var d = 0.5;
					m.style.webkitTransition = '-webkit-transform ' + d + 's ease-in, opacity ' + d +
						's ease-in';
					m.style.opacity = '0';
					setTimeout(function() {
						document.body.removeChild(m)
					}, d * 1000);
				}, duration);
			}

			function compareMain() {
				compareFn(compare, to, from)
				compareFn(compare1, to, from1)
				compareFn(compare2, to, from2)
				compareFn(compare3, to, from3)
				compareFn(compare4, to, from4)
				compareFn(compare5, to, from5)
			}

			function compareFn(target, originData, newData) {
				target.html(eq({
					value1: originData.val(),
					value2: newData.text()
				}).value2)
			}
			
			function eq(op) {
        if (!op) {
            return op;
        }
        if (!op.eq_min) {
            op.eq_min = 3;
        }
        if (!op.eq_index) {
            op.eq_index = 5;
        }
        if (!op.value1 || !op.value2) {
            return op;
        }
        var ps = {
            v1_i: 0,
            v1_new_value: "",
            v2_i: 0,
            v2_new_value: ""
        };
        while (ps.v1_i < op.value1.length && ps.v2_i < op.value2.length) {
            if (op.value1[ps.v1_i] == op.value2[ps.v2_i]) {
                //ps.v1_new_value += op.value1[ps.v1_i].replace(/</g,"<").replace(">",">");
                ps.v2_new_value += op.value2[ps.v2_i]
                    .replace(/</g, "<")
                    .replace(">", ">");
                ps.v1_i += 1;
                ps.v2_i += 1;
                //值2增加的部分
                if (ps.v1_i >= op.value1.length) {
                    ps.v2_new_value +=
                        "<del style='color:red'>" +
                        op.value2
                            .substr(ps.v2_i)
                            .replace(/</g, "<")
                            .replace(">", ">") +
                        "</del>";
                    break;
                }
                //值1删除的部分
                if (ps.v2_i >= op.value2.length) {
                    //ps.v1_new_value += "<span style='" + op.value1_style + "'>值1多的" + op.value1.substr(ps.v1_i).replace(/</g,"<").replace(">",">") + "</span>";
                    ps.v2_new_value +=
                        "<span style='color:green'>" +
                        op.value1
                            .substr(ps.v1_i)
                            .replace(/</g, "<")
                            .replace(">", ">") +
                        "</span>";
                    break;
                }
            } else {
                ps.v1_index = ps.v1_i + 1;
                ps.v1_eq_length = 0;
                ps.v1_eq_max = 0;
                ps.v1_start = ps.v1_i + 1;
                while (ps.v1_index < op.value1.length) {
                    if (
                        op.value1[ps.v1_index] == op.value2[ps.v2_i + ps.v1_eq_length]
                    ) {
                        ps.v1_eq_length += 1;
                    } else if (ps.v1_eq_length > 0) {
                        if (ps.v1_eq_max < ps.v1_eq_length) {
                            ps.v1_eq_max = ps.v1_eq_length;
                            ps.v1_start = ps.v1_index - ps.v1_eq_length;
                        }
                        ps.v1_eq_length = 0;
                        break; //只寻找最近的
                    }
                    ps.v1_index += 1;
                }
                if (ps.v1_eq_max < ps.v1_eq_length) {
                    ps.v1_eq_max = ps.v1_eq_length;
                    ps.v1_start = ps.v1_index - ps.v1_eq_length;
                }

                ps.v2_index = ps.v2_i + 1;
                ps.v2_eq_length = 0;
                ps.v2_eq_max = 0;
                ps.v2_start = ps.v2_i + 1;
                while (ps.v2_index < op.value2.length) {
                    if (
                        op.value2[ps.v2_index] == op.value1[ps.v1_i + ps.v2_eq_length]
                    ) {
                        ps.v2_eq_length += 1;
                    } else if (ps.v2_eq_length > 0) {
                        if (ps.v2_eq_max < ps.v2_eq_length) {
                            ps.v2_eq_max = ps.v2_eq_length;
                            ps.v2_start = ps.v2_index - ps.v2_eq_length;
                        }
                        ps.v1_eq_length = 0;
                        break; //只寻找最近的
                    }
                    ps.v2_index += 1;
                }
                if (ps.v2_eq_max < ps.v2_eq_length) {
                    ps.v2_eq_max = ps.v2_eq_length;
                    ps.v2_start = ps.v2_index - ps.v2_eq_length;
                }
                if (
                    ps.v1_eq_max < op.eq_min &&
                    ps.v1_start - ps.v1_i > op.eq_index
                ) {
                    ps.v1_eq_max = 0;
                }
                if (
                    ps.v2_eq_max < op.eq_min &&
                    ps.v2_start - ps.v2_i > op.eq_index
                ) {
                    ps.v2_eq_max = 0;
                }
                if (ps.v1_eq_max == 0 && ps.v2_eq_max == 0) {
                    //两个值的字不同
                    //ps.v1_new_value += "<span style='" + op.value1_style + "'>不同的" + op.value1[ps.v1_i].replace(/</g,"<").replace(">",">") + "</span>";
                    ps.v2_new_value +=
                        "<span style='color:green'>" +
                        op.value1[ps.v1_i].replace(/</g, "<").replace(">", ">") +
                        "</span>";
                    ps.v2_new_value +=
                        "<del style='color:red'>" +
                        op.value2[ps.v2_i].replace(/</g, "<").replace(">", ">") +
                        "</del>";
                    ps.v1_i += 1;
                    ps.v2_i += 1;

                    if (ps.v1_i >= op.value1.length) {
                        //值2增加的部分
                        ps.v2_new_value +=
                            "<del style='color:red'>" +
                            op.value2
                                .substr(ps.v2_i)
                                .replace(/</g, "<")
                                .replace(">", ">") +
                            "</del>";
                        break;
                    }
                    if (ps.v2_i >= op.value2.length) {
                        //值1删除的部分
                        //ps.v1_new_value += "<span style='" + op.value1_style + "'>值1多的" + op.value1.substr(ps.v1_i).replace(/</g,"<").replace(">",">") + "</span>";
                        ps.v2_new_value +=
                            "<span style='color:green'>" +
                            op.value1
                                .substr(ps.v1_i)
                                .replace(/</g, "<")
                                .replace(">", ">") +
                            "</span>";
                        break;
                    }
                    //值1删除的
                } else if (ps.v1_eq_max > ps.v2_eq_max) {
                    //ps.v1_new_value += "<span style='" + op.value1_style + "'>值1删除的" + op.value1.substr(ps.v1_i, ps.v1_start - ps.v1_i).replace(/</g,"<").replace(">",">") + "</span>";
                    ps.v2_new_value +=
                        "<span style='color:green'>" +
                        op.value1
                            .substr(ps.v1_i, ps.v1_start - ps.v1_i)
                            .replace(/</g, "<")
                            .replace(">", ">") +
                        "</span>";
                    ps.v1_i = ps.v1_start;
                } else {
                    //值2增加的
                    ps.v2_new_value +=
                        "<del style='color:red'>" +
                        op.value2
                            .substr(ps.v2_i, ps.v2_start - ps.v2_i)
                            .replace(/</g, "<")
                            .replace(">", ">") +
                        "</del>";
                    ps.v2_i = ps.v2_start;
                }
            }
        }
        op.value1 = ps.v1_new_value;
        op.value2 = ps.v2_new_value;
        //有多个连着修改的放在一起
        var addRule = /<del style='color:red'>((?!<del).)+<\/del>/g;
        var deleteRule = /<span style='color:green'>((?!<span).)+<\/span>/g;
        var allRule = /(<span style='color:green'>((?!<span).)+<\/span><del style='color:red'>((?!<del).)+<\/del>){2,}/g;
        op.value2 = op.value2.replace(allRule, function (str) {
            var beforText = "",
                afterText = "";
            var beforeMatch = str.match(deleteRule);
            for (var i = 0; i < beforeMatch.length; i++) {
                var m = beforeMatch[i].match(deleteRule);
                beforText += RegExp.$1;
            }
            var afterMatch = str.match(addRule);
            for (var i = 0; i < afterMatch.length; i++) {
                var m = afterMatch[i].match(addRule);
                afterText += RegExp.$1;
            }
            return (
                "<span style='color:green'>" +
                beforText +
                "</span><del style='color:red'>" +
                afterText +
                "</del>"
            );
        });
        return op;
    }
		</script>  
    </body>
</html>
